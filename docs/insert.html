<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M18 from src/site/markdown/docs/insert.md at 03 Jun 2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M18" />
    <title>MyBatis Dynamic SQL</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.0.0-M9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.0.0-M9.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="../docs/introduction.html">MyBatis Dynamic SQL</a></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="http://www.mybatis.org/" class="externalLink"><img class="imageLink" src="https://mybatis.org/images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 03 Jun 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.5.2</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">User&apos;s Guide</li>
    <li><a href="../docs/introduction.html">Introduction</a></li>
    <li><a href="../docs/CHANGELOG.html">Change Log</a></li>
    <li><a href="../docs/quickStart.html">Quick Start</a></li>
    <li><a href="../docs/exceptions.html">Exceptions thrown by the Library</a></li>
    <li><a href="../docs/configuration.html">Configuration of the Library</a></li>
    <li><a href="../docs/databaseObjects.html">Modeling Database Objects</a></li>
    <li><a href="../docs/whereClauses.html"><span class="icon-chevron-down"></span>WHERE Clause Support</a>
     <ul class="nav nav-list">
      <li><a href="../docs/conditions.html">WHERE Conditions</a></li>
     </ul></li>
    <li><a href="../docs/select.html"><span class="icon-chevron-down"></span>SELECT Statements</a>
     <ul class="nav nav-list">
      <li><a href="../docs/caseExpressions.html">Case Expressions</a></li>
      <li><a href="../docs/complexQueries.html">Complex Queries</a></li>
     </ul></li>
    <li><a href="../docs/delete.html">DELETE Statements</a></li>
    <li class="active"><a>INSERT Statements</a></li>
    <li><a href="../docs/update.html">UPDATE Statements</a></li>
    <li><a href="../docs/subQueries.html">SubQuery Support</a></li>
    <li><a href="../docs/functions.html">Database Functions</a></li>
    <li><a href="../docs/mybatis3.html">MyBatis3 Support</a></li>
    <li><a href="../docs/spring.html">Spring Support</a></li>
    <li><a href="../docs/springBatch.html">Spring Batch Support</a></li>
    <li><a href="../docs/kotlinOverview.html"><span class="icon-chevron-right"></span>Kotlin Support</a></li>
    <li><a href="../docs/howItWorks.html">How it Works</a></li>
    <li><a href="../docs/extending.html">Extending the Library</a></li>
    <li><a href="../docs/codingStandards.html">Coding Standards</a></li>
    <li><a href="../docs/motivation.html">Motivation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Insert_Statements"></a>
<h1>Insert Statements</h1>
<p>The library will generate a variety of INSERT statements:</p>
<ol style="list-style-type: decimal;">

<li>An insert for a single row</li>
<li>An insert for multiple rows with a single statement</li>
<li>An insert for multiple rows with a JDBC batch</li>
<li>A general insert statement</li>
<li>An insert with a select statement</li>
</ol><section><a id="Single_Row_Insert"></a>
<h2>Single Row Insert</h2>
<p>A single record insert is a statement that inserts a single record into a table.  This statement is configured differently than other statements in the library so that MyBatis' support for generated keys will work properly.  To use the statement, you must first create an object that will map to the database row, then map object attributes to fields in the database.  For example:</p>

<pre><code class="language-java">...
    SimpleTableRecord row = new SimpleTableRecord();
    row.setId(100);
    row.setFirstName(&quot;Joe&quot;);
    row.setLastName(&quot;Jones&quot;);
    row.setBirthDate(new Date());
    row.setEmployed(true);
    row.setOccupation(&quot;Developer&quot;);

    InsertStatementProvider&lt;SimpleTableRecord&gt; insertStatement = insert(row)
            .into(simpleTable)
            .map(id).toProperty(&quot;id&quot;)
            .map(firstName).toProperty(&quot;firstName&quot;)
            .map(lastName).toProperty(&quot;lastName&quot;)
            .map(birthDate).toProperty(&quot;birthDate&quot;)
            .map(employed).toProperty(&quot;employed&quot;)
            .map(occupation).toProperty(&quot;occupation&quot;)
            .build()
            .render(RenderingStrategies.MYBATIS3);

    int rows = mapper.insert(insertStatement);
...
</code></pre>
<p>Notice the <code>map</code> method.  It is used to map a database column to an attribute of the record to insert.  There are several different mappings available:</p>
<ol style="list-style-type: decimal;">

<li><code>map(column).toNull()</code> will insert a null into a column</li>
<li><code>map(column).toConstant(constant_value)</code> will insert a constant into a column.  The constant_value will be written into the generated insert statement exactly as entered</li>
<li><code>map(column).toStringConstant(constant_value)</code> will insert a constant into a column.  The constant_value will be written into the generated insert statement surrounded by single quote marks (as an SQL String)</li>
<li><code>map(column).toProperty(property)</code> will insert a value from the record into a column.  The value of the property will be bound to the SQL statement as a prepared statement parameter</li>
<li><code>map(column).toPropertyWhenPresent(property, Supplier&lt;?&gt; valueSupplier)</code> will insert a value from the record into a column if the value is non-null.  The value of the property will be bound to the SQL statement as a prepared statement parameter.  This is used to generate a &#x201c;selective&#x201d; insert as defined in MyBatis Generator.</li>
<li><code>map(column).toRow()</code> will insert the record itself into a column. This is appropriate when the &#x201c;record&#x201d; is a simple class like Integer or String.</li>
</ol><section><a id="Annotated_Mapper_for_Single_Row_Insert_Statements"></a>
<h3>Annotated Mapper for Single Row Insert Statements</h3>
<p>The InsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.  If you
are using an annotated mapper, the insert method should look like this (with @Options added for generated values if necessary):</p>

<pre><code class="language-java">import org.apache.ibatis.annotations.InsertProvider;
import org.mybatis.dynamic.sql.insert.render.InsertStatementProvider;
import org.mybatis.dynamic.sql.util.SqlProviderAdapter;

...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;insert&quot;)
    int insert(InsertStatementProvider&lt;SimpleTableRecord&gt; insertStatement);
...

</code></pre></section><section><a id="XML_Mapper_for_Single_Row_Insert_Statements"></a>
<h3>XML Mapper for Single Row Insert Statements</h3>
<p>We do not recommend using an XML mapper for insert statements, but if you want to do so the InsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.</p>
<p>If you are using an XML mapper, the insert method should look like this in the Java interface:</p>

<pre><code class="language-java">import org.mybatis.dynamic.sql.insert.render.InsertStatementProvider;

...
    int insert(InsertStatementProvider&lt;SimpleTableRecord&gt; insertStatement);
...

</code></pre>
<p>The XML element should look like this (with attributes added for generated values if necessary):</p>

<pre><code class="language-xml">  &lt;insert id=&quot;insert&quot;&gt;
    ${insertStatement}
  &lt;/insert&gt;
</code></pre></section><section><a id="Generated_Values"></a>
<h3>Generated Values</h3>
<p>MyBatis supports returning generated values from a single row insert, or a batch insert.  In either case, it is simply a matter of configuring the insert mapper method appropriately.  For example, to retrieve the value of a calculated column configure your mapper method like this:</p>

<pre><code class="language-java">...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;insert&quot;)
    @Options(useGeneratedKeys=true, keyProperty=&quot;row.fullName&quot;)
    int insert(InsertStatementProvider&lt;GeneratedAlwaysRecord&gt; insertStatement);
...
</code></pre>
<p>The important thing is that the <code>keyProperty</code> is set correctly.  It should always be in the form <code>row.&lt;attribute&gt;</code> where <code>&lt;attribute&gt;</code> is the attribute of the record class that should be updated with the generated value.</p></section></section><section><a id="Multiple_Row_Insert_Support"></a>
<h2>Multiple Row Insert Support</h2>
<p>A multiple row insert is a single insert statement that inserts multiple rows into a table. This can be a convenient way to insert a few rows into a table, but it has some limitations:</p>
<ol style="list-style-type: decimal;">

<li>Since it is a single SQL statement, you could generate quite a lot of prepared statement parameters. For example, suppose you wanted to insert 1000 records into a table, and each record had 5 fields. With a multiple row insert you would generate a SQL statement with 5000 parameters. There are limits to the number of parameters allowed in a JDBC prepared statement - and this kind of insert could easily exceed those limits. If you want to insert many records, you should probably use a JDBC batch insert instead (see below)</li>
<li>The performance of a giant insert statement may be less than you expect. If you have many records to insert, it will almost always be more efficient to use a JDBC batch insert (see below). With a batch insert, the JDBC driver can do some optimization that is not possible with a single large statement</li>
<li>Retrieving generated values with multiple row inserts can be a challenge. MyBatis currently has some limitations related to retrieving generated keys in multiple row inserts that require special considerations (see below)</li>
</ol>
<p>Nevertheless, there are use cases for a multiple row insert - especially when you just want to insert a few records in a table and don't need to retrieve generated keys. In those situations, a multiple row insert will be an easy solution.</p>
<p>A multiple row insert statement looks like this:</p>

<pre><code class="language-java">    try (SqlSession session = sqlSessionFactory.openSession()) {
        GeneratedAlwaysAnnotatedMapper mapper = session.getMapper(GeneratedAlwaysAnnotatedMapper.class);
        List&lt;GeneratedAlwaysRecord&gt; records = getRecordsToInsert(); // not shown

        MultiRowInsertStatementProvider&lt;GeneratedAlwaysRecord&gt; multiRowInsert = insertMultiple(records)
                .into(generatedAlways)
                .map(id).toProperty(&quot;id&quot;)
                .map(firstName).toProperty(&quot;firstName&quot;)
                .map(lastName).toProperty(&quot;lastName&quot;)
                .build()
                .render(RenderingStrategies.MYBATIS3);

        int rows = mapper.insertMultiple(multiRowInsert);
    }
</code></pre><section><a id="Annotated_Mapper_for_Multiple_Row_Insert_Statements"></a>
<h3>Annotated Mapper for Multiple Row Insert Statements</h3>
<p>The MultiRowInsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.  If you
are using an annotated mapper, the insert method should look like this:</p>

<pre><code class="language-java">import org.apache.ibatis.annotations.InsertProvider;
import org.mybatis.dynamic.sql.insert.render.MultiRowInsertStatementProvider;
import org.mybatis.dynamic.sql.util.SqlProviderAdapter;

...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;insertMultiple&quot;)
    int insertMultiple(MultiRowInsertStatementProvider&lt;SimpleTableRecord&gt; insertStatement);
...

</code></pre></section><section><a id="XML_Mapper_for_Multiple_Row_Insert_Statements"></a>
<h3>XML Mapper for Multiple Row Insert Statements</h3>
<p>We do not recommend using an XML mapper for insert statements, but if you want to do so the MultiRowInsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.</p>
<p>If you are using an XML mapper, the insert method should look like this in the Java interface:</p>

<pre><code class="language-java">import org.mybatis.dynamic.sql.insert.render.MultiInsertStatementProvider;

...
    int insertMultiple(MultiRowInsertStatementProvider&lt;SimpleTableRecord&gt; insertStatement);
...

</code></pre>
<p>The XML element should look like this:</p>

<pre><code class="language-xml">  &lt;insert id=&quot;insertMultiple&quot;&gt;
    ${insertStatement}
  &lt;/insert&gt;
</code></pre></section><section><a id="Generated_Values_1"></a>
<h3>Generated Values</h3>
<p>MyBatis supports returning generated values from a multiple row insert statement with some limitations. The main
limitation is that MyBatis does not support nested lists in parameter objects. Unfortunately, the
<code>MultiRowInsertStatementProvider</code> relies on a nested List. It is likely this limitation in MyBatis will be removed at
some point in the future, so stay tuned.</p>
<p>Nevertheless, you can configure a mapper that will work with the <code>MultiRowInsertStatementProvider</code> as created by this
library. The main idea is to decompose the statement from the parameter map and send them as separate parameters to the
MyBatis mapper. For example:</p>

<pre><code class="language-java">...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;insertMultipleWithGeneratedKeys&quot;)
    @Options(useGeneratedKeys=true, keyProperty=&quot;records.fullName&quot;)
    int insertMultipleWithGeneratedKeys(String insertStatement, @Param(&quot;records&quot;) List&lt;GeneratedAlwaysRecord&gt; records);

    default int insertMultipleWithGeneratedKeys(MultiRowInsertStatementProvider&lt;GeneratedAlwaysRecord&gt; multiInsert) {
        return insertMultipleWithGeneratedKeys(multiInsert.getInsertStatement(), multiInsert.getRecords());
    }
...
</code></pre>
<p>The first method above shows the actual MyBatis mapper method. Note the use of the <code>@Options</code> annotation to specify
that we expect generated values. Further, note that the <code>keyProperty</code> is set to <code>records.fullName</code> - in this case,
<code>fullName</code> is a property of the objects in the <code>records</code> List. The library supplied adapter method will simply
return the <code>insertStatement</code> as supplied in the method call. The adapter method requires that there be one, and only
one, String parameter in the method call, and it assumes that this one String parameter is the SQL insert statement.
The parameter can have any name and can be specified in any position in the method's parameter list.
The <code>@Param</code> annotation is not required for the insert statement. However, it may be specified if you so desire.</p>
<p>The second method above decomposes the <code>MultiRowInsertStatementProvider</code> and calls the first method.</p></section></section><section><a id="Batch_Insert_Support"></a>
<h2>Batch Insert Support</h2>
<p>A batch insert is a collection of statements that can be used to execute a JDBC batch.  A batch is the preferred method of doing bulk inserts with JDBC.  The basic idea is that you configure the connection for a batch insert, then execute the same statement multiple times, with different values for each inserted record.  MyBatis has a nice abstraction of JDBC batches that works well with statements generated from this library.  A batch insert looks like this:</p>

<pre><code class="language-java">...
    try(SqlSession session = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
        SimpleTableMapper mapper = session.getMapper(SimpleTableMapper.class);
        List&lt;SimpleTableRecord&gt; records = getRecordsToInsert(); // not shown

        BatchInsert&lt;SimpleTableRecord&gt; batchInsert = insert(records)
                .into(simpleTable)
                .map(id).toProperty(&quot;id&quot;)
                .map(firstName).toProperty(&quot;firstName&quot;)
                .map(lastName).toProperty(&quot;lastName&quot;)
                .map(birthDate).toProperty(&quot;birthDate&quot;)
                .map(employed).toProperty(&quot;employed&quot;)
                .map(occupation).toProperty(&quot;occupation&quot;)
                .build()
                .render(RenderingStrategies.MYBATIS3);

        batchInsert.insertStatements().forEach(mapper::insert);

        session.commit();
    }
...
</code></pre>
<p>It is important to open a MyBatis session by setting the executor type to BATCH.  The records are inserted on the commit.  You can call commit multiple times if you want to do intermediate commits.</p>
<p>Notice that the same mapper method that is used to insert a single record is now executed multiple times.  The <code>map</code> methods are the same with the exception that the <code>toPropertyWhenPresent</code> mapping is not supported for batch inserts.</p></section><section><a id="General_Insert_Statement"></a>
<h2>General Insert Statement</h2>
<p>A general insert is used to build arbitrary insert statements. The general insert does not require a separate record object to hold values for the statement - any value can be passed into the statement. This version of the insert is not convenient for retrieving generated keys with MyBatis - for that use case we recommend the &#x201c;single record insert&#x201d;. However the general insert is perfectly acceptable for Spring JDBC template or MyBatis inserts that do not return generated keys. For example</p>

<pre><code class="language-java">    GeneralInsertStatementProvider insertStatement = insertInto(animalData)
            .set(id).toValue(101)
            .set(animalName).toStringConstant(&quot;Fred&quot;)
            .set(brainWeight).toConstant(&quot;2.2&quot;)
            .set(bodyWeight).toValue(4.5)
            .build()
            .render(RenderingStrategies.MYBATIS3);
</code></pre>
<p>Notice the <code>set</code> method.  It is used to set the value for a database column.  There are several different possibilities:</p>
<ol style="list-style-type: decimal;">

<li><code>set(column).toNull()</code> will insert a null into a column</li>
<li><code>set(column).toConstant(constant_value)</code> will insert a constant into a column.  The constant_value will be written into the generated insert statement exactly as entered</li>
<li><code>set(column).toStringConstant(constant_value)</code> will insert a constant into a column.  The constant_value will be written into the generated insert statement surrounded by single quote marks (as an SQL String)</li>
<li><code>set(column).toValue(value)</code> will insert a value into a column.  The value of the property will be bound to the SQL statement as a prepared statement parameter</li>
<li><code>set(column).toValueWhenPresent(property, Supplier&lt;?&gt; valueSupplier)</code> will insert a value into a column if the value is non-null.  The value of the property will be bound to the SQL statement as a prepared statement parameter.</li>
</ol><section><a id="Annotated_Mapper_for_General_Insert_Statements"></a>
<h3>Annotated Mapper for General Insert Statements</h3>
<p>The GeneralInsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.  If you
are using an annotated mapper, the insert method should look like this:</p>

<pre><code class="language-java">import org.apache.ibatis.annotations.InsertProvider;
import org.mybatis.dynamic.sql.insert.render.GeneralInsertStatementProvider;
import org.mybatis.dynamic.sql.util.SqlProviderAdapter;

...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;generalInsert&quot;)
    int generalInsert(GeneralInsertStatementProvider insertStatement);
...

</code></pre></section><section><a id="XML_Mapper_for_General_Insert_Statements"></a>
<h3>XML Mapper for General Insert Statements</h3>
<p>We do not recommend using an XML mapper for insert statements, but if you want to do so the GeneralInsertStatementProvider object can be used as a parameter to a MyBatis mapper method directly.</p>
<p>If you are using an XML mapper, the insert method should look like this in the Java interface:</p>

<pre><code class="language-java">import org.mybatis.dynamic.sql.insert.render.GeneralInsertStatementProvider;

...
    int generalInsert(GeneralInsertStatementProvider insertStatement);
...

</code></pre>
<p>The XML element should look like this:</p>

<pre><code class="language-xml">  &lt;insert id=&quot;generalInsert&quot;&gt;
    ${insertStatement}
  &lt;/insert&gt;
</code></pre></section></section><section><a id="Insert_with_Select"></a>
<h2>Insert with Select</h2>
<p>An insert select is an SQL insert statement the inserts the results of a select statement.  For example:</p>

<pre><code class="language-java">    InsertSelectStatementProvider insertSelectStatement = insertInto(animalDataCopy)
            .withColumnList(id, animalName, bodyWeight, brainWeight)
            .withSelectStatement(
                select(id, animalName, bodyWeight, brainWeight)
                .from(animalData)
                .where(id, isLessThan(22)))
            .build()
            .render(RenderingStrategies.MYBATIS3);

    int rows = mapper.insertSelect(insertSelectStatement);
</code></pre>
<p>The column list is optional and can be removed if the selected columns match the layout of the table.</p><section><a id="Annotated_Mapper_for_Insert_Select_Statements"></a>
<h3>Annotated Mapper for Insert Select Statements</h3>
<p>The InsertSelectStatementProvider object can be used as a parameter to a MyBatis mapper method directly.  If you
are using an annotated mapper, the insert method should look like this:</p>

<pre><code class="language-java">import org.apache.ibatis.annotations.InsertProvider;
import org.mybatis.dynamic.sql.insert.render.InsertSelectStatementProvider;
import org.mybatis.dynamic.sql.util.SqlProviderAdapter;

...
    @InsertProvider(type=SqlProviderAdapter.class, method=&quot;insertSelect&quot;)
    int insertSelect(InsertSelectStatementProvider insertSelectStatement);
...
</code></pre>
<p>Note that MyBatis does not support overloaded mapper method names, so the name of the method should be different than the single record insert in a mapper.</p></section><section><a id="XML_Mapper_for_Insert_Select_Statements"></a>
<h3>XML Mapper for Insert Select Statements</h3>
<p>We do not recommend using an XML mapper for insert statements, but if you want to do so the InsertSelectStatementProvider object can be used as a parameter to a MyBatis mapper method directly.</p>
<p>If you are using an XML mapper, the insert method should look like this in the Java interface:</p>

<pre><code class="language-java">import org.mybatis.dynamic.sql.insert.render.InsertSelectStatementProvider;

...
    int insertSelect(InsertSelectStatementProvider insertSelectStatement);
...

</code></pre>
<p>The XML element should look like this:</p>

<pre><code class="language-xml">  &lt;insert id=&quot;insertSelect&quot;&gt;
    ${insertStatement}
  &lt;/insert&gt;
</code></pre></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2016–2024
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>