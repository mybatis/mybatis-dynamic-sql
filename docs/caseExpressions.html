<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M18 from src/site/markdown/docs/caseExpressions.md at 03 Jun 2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M18" />
    <title>MyBatis Dynamic SQL</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.0.0-M9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.0.0-M9.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="../docs/introduction.html">MyBatis Dynamic SQL</a></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="http://www.mybatis.org/" class="externalLink"><img class="imageLink" src="https://mybatis.org/images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 03 Jun 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.5.2</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">User&apos;s Guide</li>
    <li><a href="../docs/introduction.html">Introduction</a></li>
    <li><a href="../docs/CHANGELOG.html">Change Log</a></li>
    <li><a href="../docs/quickStart.html">Quick Start</a></li>
    <li><a href="../docs/exceptions.html">Exceptions thrown by the Library</a></li>
    <li><a href="../docs/configuration.html">Configuration of the Library</a></li>
    <li><a href="../docs/databaseObjects.html">Modeling Database Objects</a></li>
    <li><a href="../docs/whereClauses.html"><span class="icon-chevron-down"></span>WHERE Clause Support</a>
     <ul class="nav nav-list">
      <li><a href="../docs/conditions.html">WHERE Conditions</a></li>
     </ul></li>
    <li><a href="../docs/select.html"><span class="icon-chevron-down"></span>SELECT Statements</a>
     <ul class="nav nav-list">
      <li class="active"><a>Case Expressions</a></li>
      <li><a href="../docs/complexQueries.html">Complex Queries</a></li>
     </ul></li>
    <li><a href="../docs/delete.html">DELETE Statements</a></li>
    <li><a href="../docs/insert.html">INSERT Statements</a></li>
    <li><a href="../docs/update.html">UPDATE Statements</a></li>
    <li><a href="../docs/subQueries.html">SubQuery Support</a></li>
    <li><a href="../docs/functions.html">Database Functions</a></li>
    <li><a href="../docs/mybatis3.html">MyBatis3 Support</a></li>
    <li><a href="../docs/spring.html">Spring Support</a></li>
    <li><a href="../docs/springBatch.html">Spring Batch Support</a></li>
    <li><a href="../docs/kotlinOverview.html"><span class="icon-chevron-right"></span>Kotlin Support</a></li>
    <li><a href="../docs/howItWorks.html">How it Works</a></li>
    <li><a href="../docs/extending.html">Extending the Library</a></li>
    <li><a href="../docs/codingStandards.html">Coding Standards</a></li>
    <li><a href="../docs/motivation.html">Motivation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Case_Expressions_in_the_Java_DSL"></a>
<h1>Case Expressions in the Java DSL</h1>
<p>Support for case expressions was added in version 1.5.1. For information about case expressions in the Kotlin DSL, see
the <a href="kotlinCaseExpressions.html">Kotlin Case Expressions</a> page.</p><section><a id="Case_Statements_in_SQL"></a>
<h2>Case Statements in SQL</h2>
<p>The library supports different types of case expressions - a &#x201c;simple&#x201d; case expression, and a &#x201c;searched&#x201d; case
expressions.</p>
<p>A simple case expression checks the values of a single column. It looks like this:</p>

<pre><code class="language-sql">select case id
    when 1, 2, 3 then true
    else false
  end as small_id
from foo
</code></pre>
<p>Some databases also support simple comparisons on simple case expressions, which look lke this:</p>

<pre><code class="language-sql">select case total_length
    when &lt; 10 then 'small'
    when &gt; 20 then 'large'
    else 'medium'
  end as tshirt_size
from foo
</code></pre>
<p>A searched case expression allows arbitrary logic, and it can check the values of multiple columns. It looks like this:</p>

<pre><code class="language-sql">select case
    when animal_name = 'Small brown bat' or animal_name = 'Large brown bat' then 'Bat'
    when animal_name = 'Artic fox' or animal_name = 'Red fox' then 'Fox'
    else 'Other'
  end as animal_type
from foo
</code></pre></section><section><a id="Bind_Variables_and_Casting"></a>
<h2>Bind Variables and Casting</h2>
<p>The library will always render the &#x201c;when&#x201d; part of a case expression using bind variables. Rendering of the &#x201c;then&#x201d; and
&#x201c;else&#x201d; parts of a case expression may or may not use bind variables depending on how you write the query. In general,
the library will render &#x201c;then&#x201d; and &#x201c;else&#x201d; as constants - meaning not using bind variables. If you wish to use bind
variables for these parts of a case expressions, then you can use the <code>value</code> function to turn a constant into a
bind variable. We will show examples of the different renderings in the following sections.</p>
<p>If you choose to use bind variables for all &#x201c;then&#x201d; and &#x201c;else&#x201d; values, it is highly likely that the database will
require you to specify an expected datatype by using a <code>cast</code> function.</p>
<p>Even for &#x201c;then&#x201d; and &#x201c;else&#x201d; sections that are rendered with constants, you may still desire to use a <code>cast</code> in some
cases. For example, if you specify Strings for all &#x201c;then&#x201d; and &#x201c;else&#x201d; values, the database will likely return all
values as datatype CHAR with the length of the longest constant string. Typically, we would prefer the use of VARCHAR,
so we don't have to strip trailing blanks from the results. This is a good use for a <code>cast</code> with a constant.
Similarly, Java float constants are often interpreted by databases as BigDecimal. You can use a <code>cast</code> to have them
returned as floats.</p>
<p>Note: in the following sections we will use <code>?</code> to show a bind variable, but the actual rendered SQL will be different
because bind variables will be rendered appropriately for the execution engine you are using (either MyBatis or Spring).</p>
<p>Also note: in Java, <code>case</code> and <code>else</code> are reserved words - meaning we cannot use them as method names. For this reason,
the library uses <code>case_</code> and <code>else_</code> respectively as method names.</p>
<p>Full examples for case expressions are in the test code for the library here:
<a href="https://github.com/mybatis/mybatis-dynamic-sql/blob/master/src/test/java/examples/animal/data/CaseExpressionTest.java" class="externalLink">https://github.com/mybatis/mybatis-dynamic-sql/blob/master/src/test/java/examples/animal/data/CaseExpressionTest.java</a></p></section><section><a id="Java_DSL_for_Simple_Case_Statements_with_Simple_Values"></a>
<h2>Java DSL for Simple Case Statements with Simple Values</h2>
<p>A simple case expression can be coded like the following in the Java DSL:</p>

<pre><code class="language-java">select(case_(id)
    .when(1, 2, 3).then(true)
    .else_(false)
  .end().as(&quot;small_id&quot;))
.from(foo)
</code></pre>
<p>A statement written this way will render as follows:</p>

<pre><code class="language-sql">select case id when ?, ?, ? then true else false end as small_id from foo
</code></pre>
<p>Note that the &#x201c;then&#x201d; and &#x201c;else&#x201d; parts are NOT rendered with bind variables. If you with to use bind variables, then
you can write the query as follows:</p>

<pre><code class="language-java">select(case_(id)
    .when(1, 2, 3).then(value(true))
    .else_(value(false))
  .end().as(&quot;small_id&quot;))
.from(foo)
</code></pre>
<p>In this case, we are using the <code>value</code> function to denote a bind variable. The SQL will now be rendered as follows:</p>

<pre><code class="language-sql">select case id when ?, ?, ? then ? else ? end as small_id from foo
</code></pre>
<p><em>Important</em>: Be aware that your database may throw an exception for SQL like this because the database cannot determine
the datatype of the resulting column. If that happens, you will need to cast one or more of the variables to the
expected data type. Here's an example of using the <code>cast</code> function:</p>

<pre><code class="language-java">select(case_(id)
    .when(1, 2, 3).then(value(true))
    .else_(cast(value(false)).as(&quot;BOOLEAN)&quot;))
  .end().as(&quot;small_id&quot;))
.from(foo)
</code></pre>
<p>In this case, the SQL will render as follows:</p>

<pre><code class="language-sql">select case id when ?, ?, ? then ? else cast(? as BOOLEAN) end as small_id from foo
</code></pre>
<p>In our testing, casting a single bound value is enough to inform the database of your expected datatype, but
you should perform your own testing.</p></section><section><a id="Java_DSL_for_Simple_Case_Statements_with_Conditions"></a>
<h2>Java DSL for Simple Case Statements with Conditions</h2>
<p>A simple case expression can be coded like the following in the Java DSL:</p>

<pre><code class="language-java">select(case_(total_length)
    .when(isLessThan(10)).then_(&quot;small&quot;)
    .when(isGreaterThan(20)).then_(&quot;large&quot;)
    .else_(&quot;medium&quot;)
  .end().as(&quot;tshirt_size&quot;))
.from(foo)
</code></pre>
<p>A statement written this way will render as follows:</p>

<pre><code class="language-sql">select case total_length when &lt;  ? then 'small' when &gt; ? then 'large' else 'medium' end as tshirt_size from foo
</code></pre>
<p>Note that the &#x201c;then&#x201d; and &#x201c;else&#x201d; parts are NOT rendered with bind variables. If you with to use bind variables, then
you can use the <code>value</code> function as shown above.</p>
<p>A query like this could be a good place to use casting with constants. Most databases will return the calculated
&#x201c;tshirt_size&#x201d; column as CHAR(6) - so the &#x201c;small&#x201d; and &#x201c;large&#x201d; values will have a trailing blank. If you wish to use
VARCHAR, you can use the <code>cast</code> function as follows:</p>

<pre><code class="language-java">select(case_(total_length)
    .when(isLessThan(10)).then_(&quot;small&quot;)
    .when(isGreaterThan(20)).then_(&quot;large&quot;)
    .else_(cast(&quot;medium&quot;).as(&quot;VARCHAR(6)&quot;))
  .end().as(&quot;tshirt_size&quot;))
.from(foo)
</code></pre>
<p>In this case, we are using the <code>cast</code> function to specify the datatype of a constant. The SQL will now be rendered as
follows (without the line breaks):</p>

<pre><code class="language-sql">select case total_length
    when &lt;  ? then 'small' when &gt; ? then 'large'
    else cast('medium' as VARCHAR(6)) end as tshirt_size from foo
</code></pre></section><section><a id="Java_DSL_for_Searched_Case_Statements"></a>
<h2>Java DSL for Searched Case Statements</h2>
<p>A searched case statement is written as follows:</p>

<pre><code class="language-java">select(case_()
    .when(animalName, isEqualTo(&quot;Small brown bat&quot;)).or(animalName, isEqualTo(&quot;Large brown bat&quot;)).then(&quot;Bat&quot;)
    .when(animalName, isEqualTo(&quot;Artic fox&quot;)).or(animalName, isEqualTo(&quot;Red fox&quot;)).then(&quot;Fox&quot;)
    .else_(&quot;Other&quot;)
  .end().as(&quot;animal_type&quot;))
.from(foo)
</code></pre>
<p>The full syntax of &#x201c;where&#x201d; and &#x201c;having&#x201d; clauses is supported in the &#x201c;when&#x201d; clause - but that may or may not be supported
by your database. Testing is crucial. The library supports optional conditions in &#x201c;when&#x201d; clauses, but at least one
condition must render, else the library will throw an <code>InvalidSqlException</code>.</p>
<p>The rendered SQL will be as follows (without the line breaks):</p>

<pre><code class="language-sql">select case
    when animal_name = ? or animal_name = ? then 'Bat'
    when animal_name = ? or animal_name = ? then 'Fox'
    else 'Other'
  end as animal_type
from foo
</code></pre>
<p>The use of the <code>value</code> function to support bind variables, and the use of casting, is the same is shown above.</p></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2016–2024
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>