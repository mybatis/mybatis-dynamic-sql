<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/docs/whereClauses.md at 07 April 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190407" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis Dynamic SQL &#x2013; WHERE Clause Support</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../docs/introduction.html" id="bannerLeft"><h2>MyBatis Dynamic SQL</h2>
</a></div>
        <div class="pull-right"><a href="../../" id="bannerRight" title="MyBatis logo"><img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 07 April 2019<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.1.1</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">User's Guide</li>
    <li><a href="../docs/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../docs/CHANGELOG.html" title="Change Log"><span class="none"></span>Change Log</a></li>
    <li><a href="../docs/quickStart.html" title="Quick Start"><span class="none"></span>Quick Start</a></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>WHERE Clause Support</a>
    <ul class="nav nav-list">
    <li><a href="../docs/conditions.html" title="WHERE Conditions"><span class="none"></span>WHERE Conditions</a></li>
    </ul>
</li>
    <li><a href="../docs/select.html" title="SELECT Statements"><span class="none"></span>SELECT Statements</a></li>
    <li><a href="../docs/delete.html" title="DELETE Statements"><span class="none"></span>DELETE Statements</a></li>
    <li><a href="../docs/insert.html" title="INSERT Statements"><span class="none"></span>INSERT Statements</a></li>
    <li><a href="../docs/update.html" title="UPDATE Statements"><span class="none"></span>UPDATE Statements</a></li>
    <li><a href="../docs/mybatis3.html" title="MyBatis3 Support"><span class="none"></span>MyBatis3 Support</a></li>
    <li><a href="../docs/spring.html" title="Spring Support"><span class="none"></span>Spring Support</a></li>
    <li><a href="../docs/springBatch.html" title="Spring Batch Support"><span class="none"></span>Spring Batch Support</a></li>
    <li><a href="../docs/howItWorks.html" title="How it Works"><span class="none"></span>How it Works</a></li>
    <li><a href="../docs/extending.html" title="Extending the Library"><span class="none"></span>Extending the Library</a></li>
    <li><a href="../docs/codingStandards.html" title="Coding Standards"><span class="none"></span>Coding Standards</a></li>
    <li><a href="../docs/motivation.html" title="Motivation"><span class="none"></span>Motivation</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>WHERE Clause Support</h1>
<p>This library supports the creation of very flexible WHERE clauses.  WHERE clauses can be added to DELETE, SELECT, and UPDATE statements.  WHERE clauses can also stand alone for use in other hand coded SQL.</p>
<div class="section">
<h2><a name="Simple_WHERE_Clauses"></a>Simple WHERE Clauses</h2>
<p>The simplest WHERE clause is of this form:</p>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(count())
                .from(simpleTable)
                .where(id, isEqualTo(3))
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>

<p>The library ships with a wide variety of conditions that can be used in WHERE clauses including &#x201c;in&#x201d;, &#x201c;like&#x201d;, &#x201c;between&#x201d;, &#x201c;isNull&#x201d;, &#x201c;isNotNull&#x201d;, and all the normal comparison operators.  For example:</p>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(count())
                .from(simpleTable)
                .where(id, isBetween(3).and(6))
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(count())
                .from(simpleTable)
                .where(id, isIn(3,4,5))
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(count())
                .from(simpleTable)
                .where(id, isNotNull())
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
</div>
<div class="section">
<h2><a name="Complex_WHERE_Clauses"></a>Complex WHERE Clauses</h2>
<p>Conditions can be &#x201c;anded&#x201d; and &#x201c;ored&#x201d; in virtually any combination. For example:</p>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(count())
                .from(simpleTable, &quot;a&quot;)
                .where(id, isGreaterThan(2))
                .or(occupation, isNull(), and(id, isLessThan(6)))
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
</div>
<div class="section">
<h2><a name="Subqueries"></a>Subqueries</h2>
<p>Most of the conditions also support a subquery.  For example:</p>

<div>
<div>
<pre class="source">        SelectStatementProvider selectStatement = select(column1.as(&quot;A_COLUMN1&quot;), column2)
                .from(table, &quot;a&quot;)
                .where(column2, isIn(select(column2).from(table).where(column2, isEqualTo(3))))
                .or(column1, isLessThan(d))
                .build()
                .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
</div>
<div class="section">
<h2><a name="Stand_Alone_Where_Clauses"></a>Stand Alone Where Clauses</h2>
<p>You can use the where clause support on its own if you would rather code your own SQL for the remainder of a statement.  There may be several reasons to do this - mainly if the library doesn&#x2019;t support some SQL or MyBatis feature you want to use.  A good example would be paginated queries which are currently not support by the library.  If you want to use a stand alone where clause, you can code a mapper method that looks like this:</p>

<div>
<div>
<pre class="source">    @Select({
        &quot;select id, animal_name, brain_weight, body_weight&quot;,
        &quot;from AnimalData&quot;,
        &quot;${whereClause}&quot;
    })
    @ResultMap(&quot;AnimalDataResult&quot;)
    List&lt;AnimalData&gt; selectByExample(WhereClauseProvider whereClause);
</pre></div></div>

<p>You can build a stand alone where clause and call your mapper like this:</p>

<div>
<div>
<pre class="source">    WhereClauseProvider whereClause = where(id, isNotBetween(10).and(60))
            .build()
            .render(RenderingStrategy.MYBATIS3);

    List&lt;AnimalData&gt; animals = mapper.selectByExample(whereClause);
</pre></div></div>

<p>This method works well when there are no other parameters needed for the statement and when there are no table aliases involved.  If you have those other needs, then see the following.</p>
<div class="section">
<h3><a name="Table_Aliases"></a>Table Aliases</h3>
<p>If you need to use a table alias in the generated where clause you can supply it on the render method using the <tt>TableAliasCalculator</tt> class.  For example, if you have a mapper like this:</p>

<div>
<div>
<pre class="source">    @Select({
        &quot;select a.id, a.animal_name, a.brain_weight, a.body_weight&quot;,
        &quot;from AnimalData a&quot;,
        &quot;${whereClause}&quot;
    })
    @ResultMap(&quot;AnimalDataResult&quot;)
    List&lt;AnimalData&gt; selectByExampleWithAlias(WhereClauseProvider whereClause);
</pre></div></div>

<p>Then you can specify the alias for the generated WHERE clause on the render method like this:</p>

<div>
<div>
<pre class="source">    WhereClauseProvider whereClause = where(id, isEqualTo(1), or(bodyWeight, isGreaterThan(1.0)))
            .build()
            .render(RenderingStrategy.MYBATIS3, TableAliasCalculator.of(animalData, &quot;a&quot;));

    List&lt;AnimalData&gt; animals = mapper.selectByExampleWithAlias(whereClause);
</pre></div></div>

<p>It is more likely that you will be using table aliases with hand coded joins where there is more than on table alias.  In this case, you supply a <tt>Map&lt;SqlTable, String&gt;</tt> to the TableAliasCalculator that holds an alias for each table involved in the WHERE clause.</p></div>
<div class="section">
<h3><a name="Handling_Multiple_Parameters"></a>Handling Multiple Parameters</h3>
<p>By default, the WHERE clause renderer assumes that the rendered WHERE clause will be the only parameter to the mapper method. This is not always the case. For example, suppose you have a paginated query like this (this is HSQLDB syntax):</p>

<div>
<div>
<pre class="source">    @Select({
        &quot;select id, animal_name, brain_weight, body_weight&quot;,
        &quot;from AnimalData&quot;,
        &quot;${whereClauseProvider.whereClause}&quot;,
        &quot;order by id&quot;,
        &quot;OFFSET #{offset,jdbcType=INTEGER} LIMIT #{limit,jdbcType=INTEGER}&quot;
    })
    @ResultMap(&quot;AnimalDataResult&quot;)
    List&lt;AnimalData&gt; selectByExampleWithLimitAndOffset(@Param(&quot;whereClauseProvider&quot;) WhereClauseProvider whereClause,
            @Param(&quot;limit&quot;) int limit, @Param(&quot;offset&quot;) int offset);
</pre></div></div>

<p>In this mapper method there are three parameters.  So in this case it will be necessary to tell the WHERE rendered what parameter name to use the for rendered where clause.  That code looks like this:</p>

<div>
<div>
<pre class="source">    WhereClauseProvider whereClause = where(id, isLessThan(60))
            .build()
            .render(RenderingStrategy.MYBATIS3, &quot;whereClauseProvider&quot;);
            
    List&lt;AnimalData&gt; animals = mapper.selectByExampleWithLimitAndOffset(whereClause, 5, 15);
</pre></div></div>

<p>Notice that the string <tt>whereClauseProvider</tt> is used both as the parameter name in the mapper <tt>@Param</tt> annotation and the parameter name in the <tt>render</tt> method.</p>
<p>The render method also has an override that accepts a TableAliasCalculator and a parameter name.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2016&#x2013;2019
<a href="http://www.mybatis.org/">MyBatis.org</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
