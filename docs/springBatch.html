<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/markdown/docs/springBatch.md at 27 May 2025
 | Rendered using Apache Maven Fluido Skin 2.1.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>Spring Batch Support – MyBatis Dynamic SQL</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.1.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.1.0.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="../docs/introduction.html">MyBatis Dynamic SQL</a></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="http://www.mybatis.org/"><img src="https://mybatis.org/images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 03 Jun 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.0-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">User&apos;s Guide</li>
    <li><a href="../docs/introduction.html">Introduction</a></li>
    <li><a href="../docs/CHANGELOG.html">Change Log</a></li>
    <li><a href="../docs/migratingV1toV2.html">Migrating from V1 to V2</a></li>
    <li><a href="../docs/quickStart.html">Quick Start</a></li>
    <li><a href="../docs/exceptions.html">Exceptions thrown by the Library</a></li>
    <li><a href="../docs/configuration.html">Configuration of the Library</a></li>
    <li><a href="../docs/databaseObjects.html">Modeling Database Objects</a></li>
    <li><a href="../docs/whereClauses.html"><span class="icon-chevron-down"></span>WHERE Clause Support</a>
     <ul class="nav nav-list">
      <li><a href="../docs/conditions.html">WHERE Conditions</a></li>
     </ul></li>
    <li><a href="../docs/select.html"><span class="icon-chevron-down"></span>SELECT Statements</a>
     <ul class="nav nav-list">
      <li><a href="../docs/caseExpressions.html">Case Expressions</a></li>
      <li><a href="../docs/complexQueries.html">Complex Queries</a></li>
     </ul></li>
    <li><a href="../docs/delete.html">DELETE Statements</a></li>
    <li><a href="../docs/insert.html">INSERT Statements</a></li>
    <li><a href="../docs/update.html">UPDATE Statements</a></li>
    <li><a href="../docs/subQueries.html">SubQuery Support</a></li>
    <li><a href="../docs/functions.html">Database Functions</a></li>
    <li><a href="../docs/mybatis3.html">MyBatis3 Support</a></li>
    <li><a href="../docs/spring.html">Spring Support</a></li>
    <li class="active"><a>Spring Batch Support</a></li>
    <li><a href="../docs/kotlinOverview.html"><span class="icon-chevron-right"></span>Kotlin Support</a></li>
    <li><a href="../docs/howItWorks.html">How it Works</a></li>
    <li><a href="../docs/extending.html">Extending the Library</a></li>
    <li><a href="../docs/codingStandards.html">Coding Standards</a></li>
    <li><a href="../docs/motivation.html">Motivation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Spring_Batch_Support"></a>
<h1>Spring Batch Support</h1>
<p>This library provides some utilities to make it easier to interact with the MyBatis Spring Batch support.</p>
<p>MyBatis Spring provides support for interacting with Spring Batch (see
<a href="http://www.mybatis.org/spring/batch.html" class="externalLink">http://www.mybatis.org/spring/batch.html</a>). This support consists of
specialized implementations of Spring Batch's <code>ItemReader</code> and <code>ItemWriter</code> interfaces that have support for MyBatis
mappers.</p>
<p>The <code>ItemWriter</code> implementation works with SQL generated by MyBatis Dynamic SQL with no modification needed.</p>
<p>The <code>ItemReader</code> implementations need special care. Those classes assume that all query parameters will be placed in a
Map (as per usual when using multiple parameters in a query). MyBatis Dynamic SQL, by default, builds a parameter
object that is intended to be the only parameter for a query. The library contains utilities for overcoming this
difficulty.</p><section><a id="Using_MyBatisCursorItemReader"></a>
<h2>Using MyBatisCursorItemReader</h2>
<p>The <code>MyBatisCursorItemReader</code> class works with built-in support for cursor based queries in MyBatis. Queries of this
type will read row by row and MyBatis will convert each result row to a result object without having to read the entire
result set into memory. The normal rendering for MyBatis will work for queries using this reader, but special care
must be taken to prepare the parameter values for use with this reader. See the following example:</p>

<pre class="prettyprint"><code class="language-java">@Bean
public MyBatisCursorItemReader&lt;PersonRecord&gt; reader(SqlSessionFactory sqlSessionFactory) {
    SelectStatementProvider selectStatement =  select(person.allColumns())
            .from(person)
            .where(lastName, isEqualTo(&quot;flintstone&quot;))
            .build()
            .render(RenderingStrategies.MYBATIS3);

    MyBatisCursorItemReader&lt;PersonRecord&gt; reader = new MyBatisCursorItemReader&lt;&gt;();
    reader.setQueryId(PersonMapper.class.getName() + &quot;.selectMany&quot;);
    reader.setSqlSessionFactory(sqlSessionFactory);
    reader.setParameterValues(SpringBatchUtility.toParameterValues(selectStatement));
    return reader;
}
</code></pre>
<p>Note the use of <code>SpringBatchUtility.toParameterValues(...)</code>. This utility will set up the parameter Map correctly for the
rendered statement, and for use with a library supplied <code>@selectProvider</code>. See the following for an example of the mapper
method used for the query coded above:</p>

<pre class="prettyprint"><code class="language-java">@Mapper
public interface PersonMapper {

    @SelectProvider(type=SpringBatchProviderAdapter.class, method=&quot;select&quot;)
    @Results({
        @Result(column=&quot;id&quot;, property=&quot;id&quot;, id=true),
        @Result(column=&quot;first_name&quot;, property=&quot;firstName&quot;),
        @Result(column=&quot;last_name&quot;, property=&quot;lastName&quot;)
    })
    List&lt;PersonRecord&gt; selectMany(Map&lt;String, Object&gt; parameterValues);
}
</code></pre>
<p>Note the use of the <code>SpringBatchProviderAdapter</code> - that adapter knows how to retrieve the rendered queries from the
parameter map initialed in the method above.</p><section><a id="Migrating_from_1.x_Support_for_MyBatisCursorItemReader"></a>
<h3>Migrating from 1.x Support for MyBatisCursorItemReader</h3>
<p>In version 1.x, the library supplied a special utility for creating a select statement as follows:</p>

<pre class="prettyprint"><code class="language-java">SelectStatementProvider selectStatement =  SpringBatchUtility.selectForCursor(person.allColumns())
        .from(person)
        .where(lastName, isEqualTo(&quot;flintstone&quot;))
        .build()
        .render();
</code></pre>
<p>That utility method was limited in capability and has been removed. The new method described above allows the full
capabilities of the library. To migrate, follow these steps:</p>
<ol style="list-style-type: decimal;">

<li>Replace <code>SpringBatchUtility.selectForCursor(...)</code> with <code>SqlBuilder.select(...)</code></li>
<li>Replace <code>render()</code> with <code>render(RenderingStrategies.MYBATIS3)</code></li>
</ol></section></section><section><a id="Using_MyBatisPagingItemReader"></a>
<h2>Using MyBatisPagingItemReader</h2>
<p>The <code>MyBatisPagingItemReader</code> class works with paging queries - queries that read rows in pages and process page by page
rather than row by row. The normal rendering for MyBatis will work NOT for queries using this reader because MyBatis
Spring support supplies specially named parameters for page size, offset, etc. So the query must be rendered properly
to respond to these parameter values that are supplied at runtime. As with the other reader, special care
must also be taken to prepare the parameter values for use with this reader. See the following example:</p>

<pre class="prettyprint"><code class="language-java">@Bean
public MyBatisPagingItemReader&lt;PersonRecord&gt; reader(SqlSessionFactory sqlSessionFactory) {
    SelectStatementProvider selectStatement =  select(person.allColumns())
            .from(person)
            .where(forPagingTest, isEqualTo(true))
            .orderBy(id)
            .limit(SpringBatchUtility.MYBATIS_SPRING_BATCH_PAGESIZE)
            .offset(SpringBatchUtility.MYBATIS_SPRING_BATCH_SKIPROWS)
            .build()
            .render(SpringBatchUtility.SPRING_BATCH_PAGING_ITEM_READER_RENDERING_STRATEGY);

    MyBatisPagingItemReader&lt;PersonRecord&gt; reader = new MyBatisPagingItemReader&lt;&gt;();
    reader.setQueryId(PersonMapper.class.getName() + &quot;.selectMany&quot;);
    reader.setSqlSessionFactory(sqlSessionFactory);
    reader.setParameterValues(SpringBatchUtility.toParameterValues(selectStatement));
    reader.setPageSize(7);
    return reader;
}
</code></pre>
<p>Notice the following important items:</p>
<ol style="list-style-type: decimal;">

<li>The <code>limit</code> and <code>offset</code> methods in the query are used to set up paging support in the query. With MyBatis Spring
batch support, the integration library will supply values for those parameters at runtime. Any values you code in the
select statement will be ignored - only the values supplied by the library will be used. We supply two constants
to make this clearer: <code>MYBATIS_SPRING_BATCH_PAGESIZE</code> and <code>MYBATIS_SPRING_BATCH_SKIPROWS</code>. You can use these values
to make the code clearer, but again the values will be ignored at runtime.</li>
<li>The query must be rendered with the <code>SPRING_BATCH_PAGING_ITEM_READER_RENDERING_STRATEGY</code> rendering strategy. This
rendering strategy will render the query so that it will respond properly to the runtime values supplied for page size
and skip rows.</li>
<li>Note the use of <code>SpringBatchUtility.toParameterValues(...)</code>. This utility will set up the parameter Map correctly for
the rendered statement, and for use with a library supplied <code>@selectProvider</code>. See the following for an example of
the mapper method used for the query coded above:</li>
</ol>

<pre class="prettyprint"><code class="language-java">@Mapper
public interface PersonMapper {

    @SelectProvider(type=SpringBatchProviderAdapter.class, method=&quot;select&quot;)
    @Results({
        @Result(column=&quot;id&quot;, property=&quot;id&quot;, id=true),
        @Result(column=&quot;first_name&quot;, property=&quot;firstName&quot;),
        @Result(column=&quot;last_name&quot;, property=&quot;lastName&quot;)
    })
    List&lt;PersonRecord&gt; selectMany(Map&lt;String, Object&gt; parameterValues);
}
</code></pre>
<p>Note the use of the <code>SpringBatchProviderAdapter</code> - that adapter knows how to retrieve the rendered queries from the
parameter map initialed in the method above.</p><section><a id="Migrating_from_1.x_Support_for_MyBatisPagingItemReader"></a>
<h3>Migrating from 1.x Support for MyBatisPagingItemReader</h3>
<p>In version 1.x, the library supplied a special utility for creating a select statement as follows:</p>

<pre class="prettyprint"><code class="language-java">SelectStatementProvider selectStatement =  SpringBatchUtility.selectForPaging(person.allColumns())
        .from(person)
        .where(forPagingTest, isEqualTo(true))
        .orderBy(id)
        .build()
        .render();
</code></pre>
<p>That utility method was very limited in capability and has been removed. The prior method only supported limit and
offset based queries - which are not supported in all databases. The new method described above allows the full
capabilities of the library to be used. To migrate, follow these steps:</p>
<ol style="list-style-type: decimal;">

<li>Replace <code>SpringBatchUtility.selectForPaging(...)</code> with <code>SqlBuilder.select(...)</code></li>
<li>Add <code>limit()</code>, <code>fetchFirst()</code>, and <code>offset()</code> method calls as appropriate for your query and database</li>
<li>Replace <code>render()</code> with <code>render(RenderingStrategies.SPRING_BATCH_PAGING_ITEM_READER_RENDERING_STRATEGY)</code></li>
</ol></section></section><section><a id="Complete_Examples"></a>
<h2>Complete Examples</h2>
<p>The unit tests for MyBatis Dynamic SQL include a complete example of using MyBatis Spring Batch support using the
MyBatis supplied reader as well as both types of MyBatis supplied writers. You can see the full example
here: <a href="https://github.com/mybatis/mybatis-dynamic-sql/tree/master/src/test/java/examples/springbatch" class="externalLink">https://github.com/mybatis/mybatis-dynamic-sql/tree/master/src/test/java/examples/springbatch</a></p></section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2016–2025
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
