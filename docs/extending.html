<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/docs/extending.md at 21 April 2023
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>MyBatis Dynamic SQL &#x2013; Extending MyBatis Dynamic SQL</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../docs/introduction.html" id="bannerLeft"><h1>MyBatis Dynamic SQL</h1>
</a></div>
          <div class="pull-right"><a href="http://www.mybatis.org/" id="bannerRight" title="MyBatis logo"><img src="https://mybatis.org/images/mybatis-logo.png"  alt="MyBatis logo" style="" /></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 21 April 2023<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.5.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">User's Guide</li>
    <li><a href="../docs/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../docs/CHANGELOG.html" title="Change Log"><span class="none"></span>Change Log</a></li>
    <li><a href="../docs/quickStart.html" title="Quick Start"><span class="none"></span>Quick Start</a></li>
    <li><a href="../docs/exceptions.html" title="Exceptions thrown by the Library"><span class="none"></span>Exceptions thrown by the Library</a></li>
    <li><a href="../docs/configuration.html" title="Configuration of the Library"><span class="none"></span>Configuration of the Library</a></li>
    <li><a href="../docs/databaseObjects.html" title="Modeling Database Objects"><span class="none"></span>Modeling Database Objects</a></li>
    <li><a href="../docs/whereClauses.html" title="WHERE Clause Support"><span class="icon-chevron-down"></span>WHERE Clause Support</a>
     <ul class="nav nav-list">
      <li><a href="../docs/conditions.html" title="WHERE Conditions"><span class="none"></span>WHERE Conditions</a></li>
     </ul></li>
    <li><a href="../docs/select.html" title="SELECT Statements"><span class="icon-chevron-down"></span>SELECT Statements</a>
     <ul class="nav nav-list">
      <li><a href="../docs/complexQueries.html" title="Complex Queries"><span class="none"></span>Complex Queries</a></li>
     </ul></li>
    <li><a href="../docs/delete.html" title="DELETE Statements"><span class="none"></span>DELETE Statements</a></li>
    <li><a href="../docs/insert.html" title="INSERT Statements"><span class="none"></span>INSERT Statements</a></li>
    <li><a href="../docs/update.html" title="UPDATE Statements"><span class="none"></span>UPDATE Statements</a></li>
    <li><a href="../docs/subQueries.html" title="SubQuery Support"><span class="none"></span>SubQuery Support</a></li>
    <li><a href="../docs/functions.html" title="Database Functions"><span class="none"></span>Database Functions</a></li>
    <li><a href="../docs/mybatis3.html" title="MyBatis3 Support"><span class="none"></span>MyBatis3 Support</a></li>
    <li><a href="../docs/spring.html" title="Spring Support"><span class="none"></span>Spring Support</a></li>
    <li><a href="../docs/springBatch.html" title="Spring Batch Support"><span class="none"></span>Spring Batch Support</a></li>
    <li><a href="../docs/kotlinOverview.html" title="Kotlin Support"><span class="icon-chevron-right"></span>Kotlin Support</a></li>
    <li><a href="../docs/howItWorks.html" title="How it Works"><span class="none"></span>How it Works</a></li>
    <li class="active"><a><span class="none"></span>Extending the Library</a></li>
    <li><a href="../docs/codingStandards.html" title="Coding Standards"><span class="none"></span>Coding Standards</a></li>
    <li><a href="../docs/motivation.html" title="Motivation"><span class="none"></span>Motivation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Extending MyBatis Dynamic SQL</h1>
<p>The library has been designed for extension from the very start of the design.  We do not believe that the library covers all possible uses and we wanted to make it possible to add functionality that suits the needs of different projects.</p>
<p>This page details the main extension points of the library.</p><section>
<h2><a name="Extending_the_SELECT_Capabilities"></a>Extending the SELECT Capabilities</h2>
<p>The SELECT support is the most complex part of the library, and also the part of the library that is most likely to be extended.  There are two main interfaces involved with extending the SELECT support.  Picking which interface to implement is dependent on how you want to use your extension.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Interface</th>
<th>Purpose</th></tr>
</thead><tbody>

<tr class="b">
<td align="left"><code>org.mybatis.dynamic.sql.BasicColumn</code></td>
<td>Use this interface if you want to add capabilities to a SELECT list or a GROUP BY expression. For example, creating a calculated column.</td></tr>
<tr class="a">
<td align="left"><code>org.mybatis.dynamic.sql.BindableColumn</code></td>
<td>Use this interface if you want to add capabilities to a WHERE clause. For example, creating a custom condition.</td></tr>
</tbody>
</table>
<p>See the following sections for examples.</p><section>
<h3><a name="Supporting_Calculated_Columns"></a>Supporting Calculated Columns</h3>
<p>A calculated column can be used anywhere in a SELECT statement.  If you don't need to use it in a WHERE clause, then it is easier to implement the <code>org.mybatis.dynamic.sql.BasicColumn</code> interface.  An example from the library itself is the <code>org.mybatis.dynamic.sql.select.aggregate.CountAll</code> class:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">public class CountAll implements BasicColumn {
    
    private String alias;

    public CountAll() {
        super();
    }

    @Override
    public String renderWithTableAlias(TableAliasCalculator tableAliasCalculator) {
        return &quot;count(*)&quot;; //$NON-NLS-1$
    }

    @Override
    public Optional&lt;String&gt; alias() {
        return Optional.ofNullable(alias);
    }

    @Override
    public CountAll as(String alias) {
        CountAll copy = new CountAll();
        copy.alias = alias;
        return copy;
    }
}
</code></pre></div>
<p>This class is used to implement the <code>count(*)</code> function in a SELECT list.  There are only three methods to implement:</p>
<ol style="list-style-type: decimal">

<li><code>renderWithTableAlias</code> - the default renderers will write the value returned from this function into the select list - or the GROUP BY expression.  If your item can be altered by a table alias, then here is where you change the return value based on the alias specified by the user.  For a <code>count(*)</code> expression, a table alias never applies, so we just return the same value regardless of whether an alias has been specified by the user.</li>
<li><code>as</code> - this method can be called by the user to add an alias to the column expression.  In the method you should return a new instance of the object, with the alias passed by the user.</li>
<li><code>alias</code> - this method is called by the default renderer to obtain the column alias for the select list.  If there is no alias, then returning Optional.empty() will disable setting a column alias.</li>
</ol></section></section><section>
<h2><a name="Writing_Custom_Functions"></a>Writing Custom Functions</h2>
<p>Relational database vendors provide hundreds of functions in their SQL dialects to aid with queries and offload processing to the database servers. This library does not try to implement every function that exists. This library also does not provide any abstraction over the different functions on different databases. For example, bitwise operator support is non-standard and it would be difficult to provide a function in this library that worked on every database. So we take the approach of supplying examples for a few very common functions, and making it relatively easy to write your own functions.</p>
<p>The supplied functions are all in the <code>org.mybatis.dynamic.sql.select.function</code> package. They are all implemented as <code>BindableColumn</code> - meaning they can appear in a select list or a where clause.</p>
<p>We provide some base classes that you can easily extend to write functions of your own. Those classes are as follows:</p>
<p>Note: the base classes are all in the <code>org.mybatis.dynamic.sql.select.function</code> package.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Interface</th>
<th>Purpose</th></tr>
</thead><tbody>

<tr class="b">
<td align="left"><code>o.m.d.s.s.f.AbstractTypeConvertingFunction</code></td>
<td>Extend this class if you want to build a function that changes a column data type. For example, using a database function to calculate the Base64 String for a binary field.</td></tr>
<tr class="a">
<td align="left"><code>o.m.d.s.s.f.AbstractUniTypeFunction</code></td>
<td>Extend this class if you want to build a function that does not change a column data type. For example UPPER(), LOWER(), etc.</td></tr>
<tr class="b">
<td align="left"><code>o.m.d.s.s.f.OperatorFunction</code></td>
<td>Extend this class if you want to build a function the implements an operator. For example column1 + column2.</td></tr>
</tbody>
</table><section>
<h3><a name="AbstractTypeConvertingFunction_Example"></a>AbstractTypeConvertingFunction Example</h3>
<p>The following function uses HSQLDB's <code>TO_BASE64</code> function to calculate the BASE64 string for a binary field. Note that the function changes the data type from <code>byte[]</code> to <code>String</code>.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">public class ToBase64 extends AbstractTypeConvertingFunction&lt;byte[], String, ToBase64&gt; {

    protected ToBase64(BindableColumn&lt;byte[]&gt; column) {
        super(column);
    }

    @Override
    public Optional&lt;JDBCType&gt; jdbcType() {
        return Optional.of(JDBCType.VARCHAR);
    }

    @Override
    public Optional&lt;String&gt; typeHandler() {
        return Optional.empty();
    }

    @Override
    public String renderWithTableAlias(TableAliasCalculator tableAliasCalculator) {
        return &quot;TO_BASE64(&quot; //$NON-NLS-1$
                + column.renderWithTableAlias(tableAliasCalculator)
                + &quot;)&quot;; //$NON-NLS-1$
    }

    @Override
    protected ToBase64 copy() {
        return new ToBase64(column);
    }
    
    public static ToBase64 toBase64(BindableColumn&lt;byte[]&gt; column) {
        return new ToBase64(column);
    }
}
</code></pre></div></section><section>
<h3><a name="AbstractUniTypeFunction_Example"></a>AbstractUniTypeFunction Example</h3>
<p>The following function implements the common database <code>UPPER()</code> function.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">public class Upper extends AbstractUniTypeFunction&lt;String, Upper&gt; {
    
    private Upper(BindableColumn&lt;String&gt; column) {
        super(column);
    }

    @Override
    public String renderWithTableAlias(TableAliasCalculator tableAliasCalculator) {
        return &quot;upper(&quot; //$NON-NLS-1$
                + column.renderWithTableAlias(tableAliasCalculator)
                + &quot;)&quot;; //$NON-NLS-1$
    }

    @Override
    protected Upper copy() {
        return new Upper(column);
    }

    public static Upper of(BindableColumn&lt;String&gt; column) {
        return new Upper(column);
    }
}
</code></pre></div></section><section>
<h3><a name="OperatorFunction_Example"></a>OperatorFunction Example</h3>
<p>The following function implements the concatenate operator. Note that the operator can be applied to list of columns of arbitrary length:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">public class Concatenate&lt;T&gt; extends OperatorFunction&lt;T&gt; {

    protected Concatenate(BindableColumn&lt;T&gt; firstColumn, BasicColumn secondColumn,
            List&lt;BasicColumn&gt; subsequentColumns) {
        super(&quot;||&quot;, firstColumn, secondColumn, subsequentColumns); //$NON-NLS-1$
    }

    @Override
    protected Concatenate&lt;T&gt; copy() {
        return new Concatenate&lt;&gt;(column, secondColumn, subsequentColumns);
    }

    public static &lt;T&gt; Concatenate&lt;T&gt; concatenate(BindableColumn&lt;T&gt; firstColumn, BasicColumn secondColumn,
            BasicColumn... subsequentColumns) {
        return new Concatenate&lt;&gt;(firstColumn, secondColumn, Arrays.asList(subsequentColumns));
    }
}
</code></pre></div></section></section><section>
<h2><a name="Writing_Custom_Rendering_Strategies"></a>Writing Custom Rendering Strategies</h2>
<p>A RenderingStrategy is used to format the parameter placeholders in generated SQL. The library ships with two built-in rendering strategies:</p>
<ol style="list-style-type: decimal">

<li>A strategy that is suitable for MyBatis3.  This strategy generates placeholders in the format required by MyBatis3 (for example <code>#{foo,jdbcType=INTEGER}</code>).</li>
<li>A strategy that is suitable for the Spring NamedParameterJDBCTemplate. This strategy generates placeholders in the format required by Spring (for example <code>:foo</code>).</li>
</ol>
<p>You can write a custom rendering strategy if you want to use the library with some other framework.  For example, if you wanted to use the library to generate SQL that could be prepared directly by JDBC, you could write a rendering strategy that simply uses the question mark (<code>?</code>) for all parameters.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">import org.mybatis.dynamic.sql.BindableColumn;
import org.mybatis.dynamic.sql.render.RenderingStrategy;

public class PlainJDBCRenderingStrategy extends RenderingStrategy {
    @Override
    public String getFormattedJdbcPlaceholder(BindableColumn&lt;?&gt; column, String prefix, String parameterName) {
        return &quot;?&quot;;
    }

    @Override
    public String getFormattedJdbcPlaceholder(String prefix, String parameterName) {
        return &quot;?&quot;;
    }
}

</code></pre></div>
<p>The library will pass the following parameters to the <code>getFormattedJdbcPlaceholder</code> method:</p>
<ol style="list-style-type: decimal">

<li><code>column</code> - the column definition for the current placeholder</li>
<li><code>prefix</code> - For INSERT statements the value will be &#x201c;record&#x201d;, for all other statements (including inserts with selects) the value will be &#x201c;parameters&#x201d;</li>
<li><code>parameterName</code> - this will be the unique name for the parameter.  For INSERT statements, the name will be the property of the inserted record mapped to this parameter.  For all other statements (including inserts with selects) a unique name will be generated by the library.  That unique name will also be used to place the value of the parameter into the parameters Map.</li>
</ol></section><section>
<h2><a name="Writing_Custom_Renderers"></a>Writing Custom Renderers</h2>
<p>SQL rendering is accomplished by classes that are decoupled from the SQL model classes.  All the model classes have a <code>render</code> method that calls the built-in default renderers, but this is completely optional, and you do not need to use it.  You can write your own rendering support if you are dissatisfied with the SQL produced by the default renderers.</p>
<p>Writing a custom renderer is quite complex.  If you want to undertake that task, we suggest that you take the time to understand how the default renderers work first.  Feel free to ask questions about this topic on the MyBatis mailing list.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2016&#x2013;2023
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
